{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 1100,
  "height": 420,
  "title": {
    "text": "Australia: Arrivals, Departures, Net Overseas Migration",
    "fontSize": 16,
    "fontWeight": "bold",
    "anchor": "start"
  },
  "data": {
    "url": "https://raw.githubusercontent.com/loh-0/australian-migration/refs/heads/main/data/net_flow_migration.csv"
  },
  "transform": [
    {"fold": ["australian_born", "overseas_born", "total"], "as": ["series_key", "value"]},
    {
      "calculate": "datum.series_key === 'australian_born' ? 'Australian-born' : datum.series_key === 'overseas_born' ? 'Overseas-born' : 'Total (net)'",
      "as": "Series"
    }
  ],
  "layer": [
    {
      "mark": {"type": "line", "strokeWidth": 3},
      "encoding": {
        "x": {
          "field": "year",
          "type": "quantitative",
          "axis": {
            "format": "d",
            "title": "Year",
            "tickMinStep": 1,
            "labelFontSize": 12,
            "titleFontSize": 14
          }
        },
        "y": {
          "field": "value",
          "type": "quantitative",
          "title": "People",
          "axis": {
            "labelExpr": "format(datum.value, ',.0f')",
            "labelFontSize": 12,
            "titleFontSize": 14
          },
          "scale": {"nice": true, "domain": {"unionWith": [0]}}
        },
        "color": {
          "field": "Series",
          "scale": {
            "domain": ["Australian-born", "Overseas-born", "Total (net)"],
            "range": ["#2c5aa0", "#d9534f", "#5cb85c"]
          },
          "legend": {
            "title": "Series",
            "orient": "top-left",
            "labelFontSize": 12,
            "titleFontSize": 13,
            "symbolSize": 150,
            "offset": 10
          }
        }
      }
    },
    {
      "mark": {
        "type": "point",
        "filled": true,
        "size": 80,
        "stroke": "white",
        "strokeWidth": 2
      },
      "encoding": {
        "x": {"field": "year", "type": "quantitative"},
        "y": {"field": "value", "type": "quantitative"},
        "color": {"field": "Series", "legend": null},
        "tooltip": [
          {"field": "Series", "type": "nominal", "title": "Migration Type"},
          {"field": "year", "type": "quantitative", "title": "Year", "format": "d"},
          {"field": "value", "type": "quantitative", "title": "Net Migration", "format": ",.0f"}
        ]
      }
    },
    {
      "data": {
        "values": [
          {"year": 2009, "value": 300000, "text": ["2009: GFC Impact", "Migration declined sharply"]},
          {"year": 2019.3, "value": 150000, "text": ["2020: COVID-19 Pandemic", "Border closures caused historic drop"]},
          {"year": 2023, "value": 550000, "text": ["2023: Record Recovery", "Post-pandemic surge"]}
        ]
      },
      "mark": {
        "type": "text",
        "align": "center",
        "baseline": "middle",
        "dx": 0,
        "dy": 0,
        "fontSize": 14,
        "color": "#000000",
        "fontWeight": 600,
        "lineHeight": 16,
        "font": "Inter, sans-serif"
      },
      "encoding": {
        "x": {"field": "year", "type": "quantitative"},
        "y": {"field": "value", "type": "quantitative"},
        "text": {"field": "text", "type": "nominal"}
      }
    }
  ],
  "config": {
    "view": {"stroke": null},
    "background": "#f7fbff",
    "axis": {
      "grid": true,
      "gridOpacity": 0.15,
      "tickSize": 0,
      "labelFont": "Inter, sans-serif",
      "titleFont": "Inter, sans-serif"
    },
    "title": {
      "font": "Inter, sans-serif"
    },
    "legend": {
      "labelFont": "Inter, sans-serif",
      "titleFont": "Inter, sans-serif"
    },
    "text": {
      "font": "Inter, sans-serif"
    }
  }
}
