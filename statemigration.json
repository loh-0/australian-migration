{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 1100,
  "height": 600,
  "title": {
    "text": "Net Overseas Migration by State/Territory (2004â€“2023)",
    "fontWeight": "bold",
    "fontSize": 16,
    "anchor": "start"
  },
  "projection": { "type": "mercator" },

  "params": [
    {
      "name": "yr",
      "value": 2023,
      "bind": {
        "input": "range",
        "min": 2004,
        "max": 2023,
        "step": 1,
        "name": "Year: "
      }
    }
  ],

  "data": {
    "url": "https://raw.githubusercontent.com/loh-0/australian-migration/refs/heads/main/data/migration_states.csv",
    "format": {
      "type": "csv",
      "parse": { "Year": "number", "NetMigration": "number" }
    }
  },

  "transform": [
    { "filter": "datum.Year == yr" },
    {
      "lookup": "STE_NAME21",
      "from": {
        "data": {
          "url": "https://raw.githubusercontent.com/loh-0/australian-migration/refs/heads/main/australianmap.topojson",
          "format": { "type": "topojson", "feature": "australiamap" }
        },
        "key": "properties.STE_NAME21"
      },
      "as": "geo"
    },
    { "filter": "datum.geo != null" }
  ],

  "mark": { "type": "geoshape", "stroke": "white", "strokeWidth": 1.2 },

  "encoding": {
    "shape": { "field": "geo", "type": "geojson" },
    "color": {
      "field": "NetMigration",
      "type": "quantitative",
      "title": "Net Migrants",
      "scale": {
        "scheme": "redblue",
        "domainMid": 0
      },
      "legend": {
        "format": ",d",
        "labelFontSize": 12,
        "titleFontSize": 13,
        "titleFontWeight": "bold",
        "orient": "right"
      }
    },
    "tooltip": [
      { "field": "STE_NAME21", "title": "State" },
      { "field": "NetMigration", "title": "Net migrants", "format": ",d" },
      { "field": "Year", "title": "Year" }
    ]
  },

  "config": {
    "background": "#f7fbff",
    "view": { "stroke": null }
  }
}
